---
// src/pages/[lang]/recipes/index.astro
import BaseLayout from "@/layouts/BaseLayout.astro";
import RecipeCard from "@/components/RecipeCard.astro";
import FilterDrawer from "@/components/FilterDrawer";
import RecipeFilters from "@/components/RecipeFilters";
import { getRecipes } from "@/lib/supabase";

const { lang } = Astro.params as { lang: 'en' | 'fr' };

// Get URL parameters
const searchQuery = Astro.url.searchParams.get('search') || '';
const difficulty = Astro.url.searchParams.get('difficulty') || '';
const maxTime = Astro.url.searchParams.get('maxTime');
const tags = Astro.url.searchParams.getAll('tags');

// Fetch filtered recipes
const recipes = await getRecipes({ 
  search: searchQuery,
  difficulty,
  maxTime: maxTime ? parseInt(maxTime) : undefined,
  tags 
});
---

<BaseLayout title="Recipes" lang={lang}>
  <div class="grid grid-cols-1 lg:grid-cols-[250px_1fr] gap-8">
    <aside>
      <RecipeFilters 
        lang={lang} 
        client:load
        initialValues={{
          search: searchQuery,
          difficulty,
          maxTime: maxTime || '',
          tags
        }}
      />
    </aside>
    
    <div class="recipe-grid">
      {recipes.map(recipe => (
        <RecipeCard recipe={recipe} lang={lang} />
      ))}
    </div>
  </div>
</BaseLayout>