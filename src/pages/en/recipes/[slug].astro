---
import { getLocalizedRecipePaths, getFullLocalizedRecipe } from '@/lib/supabase';
import BaseLayout from '@/layouts/BaseLayout.astro';
import type { GetStaticPaths } from 'astro';
import type { LocalizedRecipePath } from '@/lib/types';

export const getStaticPaths = (async () => {
  const paths = await getLocalizedRecipePaths();
  console.log('Localized paths:', paths);
  return paths
  .filter((p: LocalizedRecipePath) => p.lang === 'en')
  .map((p: LocalizedRecipePath) => ({
    params: { slug: p.slug },
    props: { recipeId: p.recipe_id }
  }));
}) satisfies GetStaticPaths;

const { recipeId } = Astro.props as { recipeId: string };
if (!recipeId || typeof recipeId !== 'string') {
  return Astro.redirect('/404');
}

const recipe = await getFullLocalizedRecipe(recipeId, 'en');

if (!recipe) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={recipe.title} description={recipe.description} lang="en">
  <!-- Display full recipe here -->
  <h1>{recipe.title}</h1>
  <!-- Add ingredients, steps, etc. -->
</BaseLayout>